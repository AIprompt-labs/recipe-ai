<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¬ã‚·ãƒ” - èª°ã§ã‚‚ä½¿ãˆã‚‹ãƒ¬ã‚·ãƒ”é›†</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- åºƒå‘Šã®å‡ºã—åˆ†ã‘è¨­å®š --- */
.ad-desktop {
  display: block;
  text-align: center; /* ä¸­å¤®å¯„ã› */
  margin: 20px 0;
}
.ad-mobile {
  display: none;
  text-align: center;
  margin: 20px 0;
}

/* ç”»é¢å¹… 768px ä»¥ä¸‹ï¼ˆã‚¹ãƒãƒ›ï¼‰ãªã‚‰ SP åºƒå‘Šã ã‘è¡¨ç¤º */
@media (max-width: 768px) {
  .ad-desktop {
    display: none;
  }
  .ad-mobile {
    display: block;
  }
}
/* --- åºƒå‘Šã®å‡ºã—åˆ†ã‘è¨­å®š --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .recipe-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .recipe-card:hover {
            transform: translateY(-2px);
        }
        .highlight-variable {
            /* èª¿æ•´å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
            background-color: #ffedc7; /* è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ */
            color: #d97706; /* æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ã®æ–‡å­— */
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: help;
        }
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒ  */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
        /* AIç”Ÿæˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .ai-loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #e2e8f0;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase variables exposed to global scope via window
        window.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; 
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const apiKey = ""; // Gemini API Key (Runtime injected)

        if (Object.keys(firebaseConfig).length > 0) {
            setLogLevel('Debug');
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);
        } else {
            console.error("Firebase configuration is missing.");
        }

        // --- Filter Logic ---
        window.applyCategoryFilter = () => {
            const filterElement = document.getElementById('category-filter');
            if (!filterElement) return;

            const filterValue = filterElement.value;
            const recipeList = document.getElementById('recipe-list');
            // ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—
            const sections = recipeList.querySelectorAll('section[id^="category-"]');

            sections.forEach(section => {
                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³IDã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å–å¾— (ä¾‹: 'category-æ–‡ç« ç”Ÿæˆ' -> 'æ–‡ç« ç”Ÿæˆ')
                const categoryId = section.id.replace('category-', '');
                
                if (filterValue === 'all' || categoryId === filterValue) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });
        };

        window.initApp = async () => {
            if (!window.db) return;

            // Authentication
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(window.auth, __initial_auth_token);
                } catch (error) {
                    console.error("Custom token sign-in failed, trying anonymous sign-in.", error);
                    await signInAnonymously(window.auth);
                }
            } else {
                await signInAnonymously(window.auth);
            }

            window.userId = window.auth.currentUser?.uid || crypto.randomUUID();
            document.getElementById('user-id-display').textContent = `ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${window.userId}`;

            // Initialize Data and Listen
            document.getElementById('loading-indicator').classList.add('hidden');
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.getElementById('category-filter').addEventListener('change', applyCategoryFilter);
            
            // ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰é–‹å§‹
            await loadInitialDataAndListen(window.db, window.appId, window.userId);
        };

        window.loadInitialDataAndListen = async (db, appId, userId) => {
            const recipeCollectionPath = `artifacts/${appId}/public/data/recipes`;
            const recipesCollectionRef = collection(db, recipeCollectionPath);

            // é‹å–¶å´åˆæœŸãƒ¬ã‚·ãƒ”ã‚’ãƒã‚§ãƒƒã‚¯ï¼†è¿½åŠ  (åˆå›ã®ã¿)
            await checkAndAddInitialRecipe(db, recipeCollectionPath, userId);

            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            onSnapshot(recipesCollectionRef, (snapshot) => {
                const recipes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderRecipeList(recipes, userId);
                applyCategoryFilter(); // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã€ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
            }, (error) => {
                console.error("Error listening to recipes:", error);
                document.getElementById('recipe-list').innerHTML = `<p class="text-red-600">ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>`;
            });
        };

        const initialRecipeData = {
            title: "15åˆ†ã§ä½œæˆå¯èƒ½ï¼æ™‚çŸ­ãƒ¬ã‚·ãƒ”è€ƒæ¡ˆ",
            purpose: "æ–™ç†åˆå¿ƒè€…ã§ã‚‚å®Ÿè¡Œã§ãã‚‹åˆ†ã‹ã‚Šã‚„ã™ã„ãƒ¬ã‚·ãƒ”ã‚’ä½œæˆã™ã‚‹",
            ingredients: [
                "ä½œã‚ŠãŸã„äººæ•°", "æ–™ç†ã®ã‚¸ãƒ£ãƒ³ãƒ«", "èª¿ç†æ™‚é–“", "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±", "ææ–™",
                "å‘³ã®æ–¹å‘æ€§ (ä»»æ„)", "ã‚«ãƒ­ãƒªãƒ¼ (ä»»æ„)", "ç‰¹åˆ¥ç”¨é€” (ä»»æ„)", "èª¿ç†å™¨å…· (ä»»æ„)"
            ],
            prompt: `ã€æŒ‡ç¤ºã€‘
ä»¥ä¸‹ã®æ¡ä»¶ã§ã€åˆå¿ƒè€…ã§ã‚‚ä½œã‚Œã‚‹æ–™ç†ãƒ¬ã‚·ãƒ”ã‚’è€ƒæ¡ˆã—ã¦ãã ã•ã„ã€‚
ãƒ—ãƒ­ã®æ–™ç†å®¶ã®ã‚ˆã†ã«ã€ã‚ã‹ã‚Šã‚„ã™ãä¸å¯§ã«æ›¸ãã“ã¨ã€‚

ã€æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«ã€‘
{æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«}

ã€ææ–™ã€‘
{ææ–™ãƒªã‚¹ãƒˆ}

ã€äººæ•°ã€‘
{äººæ•°}

ã€èª¿ç†æ™‚é–“ã€‘
{èª¿ç†æ™‚é–“}

ã€å‘³ã®æ–¹å‘æ€§ã€‘
{å‘³ã®æ–¹å‘æ€§}

ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»åˆ¶é™ã€‘
{ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼}

ã€ç‰¹åˆ¥ç”¨é€”ã€‘
{ç‰¹åˆ¥ç”¨é€”}

ã€å‡ºåŠ›å½¢å¼ã€‘
â‘ æ–™ç†å
â‘¡æ¦‚è¦ï¼ˆã©ã‚“ãªæ–™ç†ã‹ï¼‰
â‘¢ææ–™ï¼ˆåˆ†é‡ã¤ãï¼‰
â‘£æ‰‹é †ï¼ˆç•ªå·ã§ã‚ã‹ã‚Šã‚„ã™ãï¼‰
â‘¤ã‚³ãƒ„ãƒ»ãƒã‚¤ãƒ³ãƒˆ
â‘¥ã‚¢ãƒ¬ãƒ³ã‚¸ä¾‹
â‘¦ä¿å­˜æ–¹æ³•ï¼ˆä½œã‚Šç½®ãå¯¾å¿œï¼‰`,
            ai_model: "Gemini 1.5 Pro, GPT-4",
            tips: "ãƒ»ã€Œææ–™ã€ã ã‘å…¥ã‚Œã‚‹ã¨ã€å‡ã£ãŸã‚‚ã®ãŒå‡ºã‚„ã™ã„\nãƒ»ã€Œå‘³ã®æ–¹å‘æ€§ã€ã‚’å…¥ã‚Œã‚‹ã¨ã€å¥½ã¿ã«å¯„ã›ã‚‰ã‚Œã‚‹\nãƒ»ã€Œä¿å­˜æ–¹æ³•ã€ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ä½œã‚Šç½®ãéœ€è¦ã«åˆºã•ã‚‹",
            example_output: `æ–™ç†å
é¶ã‚€ã­è‚‰ã®ç”˜è¾›ã•ã£ã±ã‚Šç…§ã‚Šç„¼ãï¼ˆ2äººå‰ï¼‰...ï¼ˆçœç•¥ï¼‰`,
            fail_points: "ãƒ»ã€Œææ–™ã€ãŒæ›–æ˜§ã ã¨å¥‡å¦™ãªãƒ¬ã‚·ãƒ”ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹\nãƒ»å°å­¦ç”Ÿã§ã‚‚ä½œã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã«ã—ãŸã„å ´åˆã¯ç´°ã‹ãæŒ‡ç¤ºã™ã‚‹\nãƒ»èª¿ç†å™¨å…·ã‚’æŒ‡å®šã—ãªã„ã¨é›£æ˜“åº¦ãŒä¸ŠãŒã‚Šã‚„ã™ã„",
            category: "æ–‡ç« ç”Ÿæˆ",
            created_at: new Date().toISOString(),
            user_id: "é‹å–¶"
        };

        const checkAndAddInitialRecipe = async (db, collectionPath, userId) => {
            const q = query(collection(db, collectionPath), where("user_id", "==", "é‹å–¶"));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                console.log("Adding initial recipe...");
                try {
                    await addDoc(collection(db, collectionPath), initialRecipeData);
                    console.log("Initial recipe added successfully.");
                } catch (e) {
                    console.error("Error adding initial recipe: ", e);
                }
            }
        };

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å®šç¾©ã¨è¡¨ç¤ºé †
        const categoriesMap = {
            "æ–‡ç« ç”Ÿæˆ": "æ–‡ç« ãƒ»ãƒ†ã‚­ã‚¹ãƒˆä½œæˆã®ãƒ¬ã‚·ãƒ”",
            "ç”»åƒç”Ÿæˆ": "ç”»åƒãƒ»ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆã®ãƒ¬ã‚·ãƒ”",
            "è‡ªå‹•åŒ–": "ä½œæ¥­åŠ¹ç‡åŒ–ãƒ»è‡ªå‹•å®Ÿè¡Œã®ãƒ¬ã‚·ãƒ”",
            "ãã®ä»–": "ã‚²ãƒ¼ãƒ ãƒ»çµµæœ¬ãƒ»å‹•ç”»ãªã©æ±ç”¨çš„ãªãƒ¬ã‚·ãƒ”"
        };

        const renderRecipeList = (recipes, currentUserId) => {
            const listElement = document.getElementById('recipe-list');
            listElement.innerHTML = '';
            
            // 1. ãƒ¬ã‚·ãƒ”ã‚’ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const groupedRecipes = recipes.reduce((acc, recipe) => {
                const category = recipe.category || "ãã®ä»–";
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(recipe);
                return acc;
            }, {});

            let totalRenderedRecipes = 0;

            // 2. ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å®šç¾©é †ã«è¦‹å‡ºã—ã¨ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            Object.keys(categoriesMap).forEach(category => {
                const categoryTitle = category;
                const categoryDescription = categoriesMap[category];
                const categoryRecipes = groupedRecipes[category] || [];

                // ãƒ¬ã‚·ãƒ”ãŒãªã„ã‚¸ãƒ£ãƒ³ãƒ«ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
                if (categoryRecipes.length === 0) {
                    return; 
                }
                
                totalRenderedRecipes += categoryRecipes.length;

                // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠ (IDã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ã«è¨­å®š)
                const section = document.createElement('section');
                section.className = 'mb-12';
                section.id = `category-${categoryTitle}`; // ã“ã“ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚­ãƒ¼ã¨ã—ã¦åˆ©ç”¨

                // å¤§è¦‹å‡ºã—
                section.innerHTML = `
                    <div class="mb-6 border-b-2 border-blue-500 pb-2">
                        <h3 class="text-3xl font-extrabold text-gray-800 tracking-tight">${categoryTitle}</h3>
                        <p class="text-gray-500 mt-1">${categoryDescription}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="recipes-for-${categoryTitle}">
                        <!-- ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å…¥ã‚Šã¾ã™ -->
                    </div>
                `;
                
                const recipesContainer = section.querySelector(`#recipes-for-${categoryTitle}`);

                categoryRecipes.forEach(recipe => {
                    const card = document.createElement('div');
                    card.className = 'recipe-card bg-white p-6 rounded-xl border border-gray-200 cursor-pointer transition duration-200 hover:border-blue-500';
                    card.onclick = () => openRecipeModal(recipe, currentUserId);
                    
                    card.innerHTML = `
                        <p class="text-sm font-semibold text-blue-600 mb-1">${recipe.category}</p>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${recipe.title}</h3>
                        <p class="text-gray-600 text-sm truncate">${recipe.purpose}</p>
                        <div class="mt-4 flex items-center justify-between text-xs text-gray-400">
                            <span>æŠ•ç¨¿è€…: ${recipe.user_id === 'é‹å–¶' ? 'é‹å–¶' : 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</span>
                            <span>ä½œæˆæ—¥: ${new Date(recipe.created_at).toLocaleDateString('ja-JP')}</span>
                        </div>
                    `;
                    recipesContainer.appendChild(card);
                });

                listElement.appendChild(section);
            });
            
            // å…¨ãƒ¬ã‚·ãƒ”ãŒç©ºã®å ´åˆã®è¡¨ç¤º
            if (totalRenderedRecipes === 0) {
                listElement.innerHTML = `<p class="text-gray-500 text-center py-8">ã¾ã èª°ã‚‚ãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>`;
            }
        };

        // --- Gemini API Call Logic ---
        async function callGemini(promptText) {
            if (!apiKey) {
                throw new Error("API Key is missing.");
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®æ§‹ç¯‰
            const payload = {
                contents: [{ parts: [{ text: promptText }] }],
            };

            // ç°¡æ˜“çš„ãªæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å‡¦ç†
            const MAX_RETRIES = 5;
            for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text || "No response generated.";
                    } else if (response.status === 429 && attempt < MAX_RETRIES - 1) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue; // ãƒªãƒˆãƒ©ã‚¤
                    } else {
                        throw new Error(`Gemini API Error: ${response.statusText}`);
                    }
                } catch (error) {
                    if (attempt === MAX_RETRIES - 1) {
                         throw error;
                    }
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // --- Modal Logic ---

        window.openRecipeModal = (recipe, currentUserId) => {
            const modal = document.getElementById('recipe-modal');
            modal.classList.remove('hidden');

            // åŸºæœ¬æƒ…å ±ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            document.getElementById('modal-title').textContent = recipe.title;
            document.getElementById('modal-category').textContent = recipe.category;
            document.getElementById('modal-purpose').textContent = recipe.purpose;
            document.getElementById('modal-ai-model').textContent = recipe.ai_model;
            document.getElementById('modal-tips').innerHTML = (recipe.tips || "").replace(/\n/g, '<br>');
            document.getElementById('modal-example-output').textContent = recipe.example_output;
            document.getElementById('modal-fail-points').innerHTML = (recipe.fail_points || "").replace(/\n/g, '<br>');
            document.getElementById('modal-ingredients').innerHTML = (recipe.ingredients || []).map(ing => `<span class="bg-gray-100 text-gray-700 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${ing}</span>`).join('');

            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†
            const promptText = recipe.prompt || "";
            const highlightedPrompt = promptText.replace(/(\{.+?\})/g, (match) => {
                const variableName = match.substring(1, match.length - 1);
                return `<span class="highlight-variable" title="èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: ${variableName}">${match}</span>`;
            });
            document.getElementById('modal-prompt-body').innerHTML = highlightedPrompt.replace(/\n/g, '<br>');

            // --- Geminiå®Ÿè¡Œã‚¨ãƒªã‚¢ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ---
            const trySection = document.getElementById('try-recipe-section');
            const inputsContainer = document.getElementById('try-recipe-inputs');
            const resultContainer = document.getElementById('try-recipe-result');
            const resultText = document.getElementById('try-recipe-output');
            
            inputsContainer.innerHTML = '';
            resultContainer.classList.add('hidden');
            resultText.textContent = '';

            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰å¤‰æ•°({å¤‰æ•°å})ã‚’æŠ½å‡ºã—ã¦å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆ
            const variables = [...promptText.matchAll(/\{(.+?)\}/g)].map(m => m[1]);
            const uniqueVars = [...new Set(variables)]; // é‡è¤‡æ’é™¤

            if (uniqueVars.length > 0) {
                trySection.classList.remove('hidden');
                uniqueVars.forEach(v => {
                    const wrapper = document.createElement('div');
                    wrapper.className = "mb-3";
                    wrapper.innerHTML = `
                        <label class="block text-xs font-bold text-gray-700 mb-1">${v}</label>
                        <input type="text" data-var="${v}" class="variable-input w-full p-2 border border-gray-300 rounded text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="${v}ã‚’å…¥åŠ›...">
                    `;
                    inputsContainer.appendChild(wrapper);
                });
            } else {
                // å¤‰æ•°ãŒãªã„å ´åˆã¯ãƒœã‚¿ãƒ³ã ã‘è¡¨ç¤º
                 trySection.classList.remove('hidden');
                 inputsContainer.innerHTML = '<p class="text-sm text-gray-500 mb-2">ã“ã®ãƒ¬ã‚·ãƒ”ã«ã¯è¨­å®šå¯èƒ½ãªå¤‰æ•°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ã¾ã¾å®Ÿè¡Œã§ãã¾ã™ã€‚</p>';
            }

            // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
            const runButton = document.getElementById('run-gemini-button');
            runButton.onclick = async () => {
                const btnText = document.getElementById('run-btn-text');
                const loader = document.getElementById('run-btn-loader');
                
                // å…¥åŠ›å€¤ã‚’å–å¾—ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
                let finalPrompt = promptText;
                const inputs = inputsContainer.querySelectorAll('input.variable-input');
                inputs.forEach(input => {
                    const key = input.getAttribute('data-var');
                    const val = input.value || `(æœªæŒ‡å®š: ${key})`;
                    // å…¨ç½®æ›
                    finalPrompt = finalPrompt.split(`{${key}}`).join(val);
                });

                // UI Loading
                runButton.disabled = true;
                runButton.classList.add('opacity-75', 'cursor-not-allowed');
                btnText.textContent = 'GeminiãŒæ€è€ƒä¸­...';
                loader.classList.remove('hidden');
                resultContainer.classList.add('hidden');

                try {
                    const result = await callGemini(finalPrompt);
                    resultText.textContent = result;
                    resultContainer.classList.remove('hidden');
                    // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } catch (err) {
                    alertMessage(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${err.message}`, 'error');
                } finally {
                    runButton.disabled = false;
                    runButton.classList.remove('opacity-75', 'cursor-not-allowed');
                    btnText.textContent = 'Geminiã§å®Ÿè¡Œã™ã‚‹';
                    loader.classList.add('hidden');
                }
            };

            // å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            const deleteButton = document.getElementById('delete-recipe-button');
            if (recipe.user_id === currentUserId) {
                deleteButton.classList.remove('hidden');
                // â˜…ä¿®æ­£ç‚¹: ã‚«ã‚¹ã‚¿ãƒ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚ˆã†ã«å¤‰æ›´
                deleteButton.onclick = () => openConfirmModal(recipe.id, recipe.title);
            } else {
                deleteButton.classList.add('hidden');
            }
        };

        window.closeModal = () => {
            document.getElementById('recipe-modal').classList.add('hidden');
            document.getElementById('new-recipe-modal').classList.add('hidden');
            document.getElementById('confirm-modal').classList.add('hidden'); // ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚‚é–‰ã˜ã‚‹
        };

        window.openNewRecipeModal = () => {
            document.getElementById('new-recipe-modal').classList.remove('hidden');
            document.getElementById('new-recipe-form').onsubmit = (e) => handleNewRecipeSubmit(e, window.db, window.appId, window.userId);
        };

        window.handleNewRecipeSubmit = async (e, db, appId, userId) => {
            e.preventDefault();
            const form = e.target;
            const newRecipe = {
                title: form.title.value,
                purpose: form.purpose.value,
                ingredients: form.ingredients.value.split(',').map(s => s.trim()).filter(s => s.length > 0),
                prompt: form.prompt.value,
                ai_model: form.ai_model.value,
                tips: form.tips.value,
                example_output: form.example_output.value,
                fail_points: form.fail_points.value,
                category: form.category.value,
                created_at: new Date().toISOString(),
                user_id: userId
            };

            try {
                const recipeCollectionPath = `artifacts/${appId}/public/data/recipes`;
                await addDoc(collection(db, recipeCollectionPath), newRecipe);
                alertMessage('æ–°ã—ã„ãƒ¬ã‚·ãƒ”ãŒæŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼', 'success');
                closeModal();
            } catch (error) {
                console.error("Error adding document: ", error);
                alertMessage('ãƒ¬ã‚·ãƒ”ã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        };

        // â˜…ä¿®æ­£ç‚¹: ã‚«ã‚¹ã‚¿ãƒ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãé–¢æ•°
        window.openConfirmModal = (recipeId, title) => {
            closeModal(); // ä»–ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            const modal = document.getElementById('confirm-modal');
            const confirmMessage = document.getElementById('confirm-message');
            const confirmButton = document.getElementById('confirm-delete-button');

            confirmMessage.textContent = `ãƒ¬ã‚·ãƒ”ã€Œ${title}ã€ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`;
            confirmButton.onclick = () => {
                deleteRecipe(recipeId);
            };
            modal.classList.remove('hidden');
        };


        // â˜…ä¿®æ­£ç‚¹: å‰Šé™¤ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£
        window.deleteRecipe = async (recipeId) => {
            if (!window.db || !window.appId) {
                alertMessage('ã‚¨ãƒ©ãƒ¼: Firebaseã¾ãŸã¯App IDãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚', 'error');
                return;
            }

            try {
                const recipeDocPath = `artifacts/${window.appId}/public/data/recipes/${recipeId}`;
                await deleteDoc(doc(window.db, recipeDocPath));
                alertMessage('ãƒ¬ã‚·ãƒ”ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚', 'success');
                closeModal();
            } catch (error) {
                console.error("Error deleting document: ", error);
                alertMessage('ãƒ¬ã‚·ãƒ”ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        };

        window.alertMessage = (message, type) => {
            const container = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            const baseClasses = "fixed top-4 right-4 z-50 p-4 rounded-lg shadow-xl text-white transition-opacity duration-300";
            alertDiv.className = type === 'success' ? `${baseClasses} bg-green-500` : `${baseClasses} bg-red-500`;
            alertDiv.textContent = message;
            container.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.classList.add('opacity-0');
                alertDiv.addEventListener('transitionend', () => alertDiv.remove());
            }, 3000);
        };

    </script>
</head>
<body onload="initApp()" class="min-h-screen">
    <!-- ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="alert-container"></div>

    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-2xl font-extrabold text-gray-900 tracking-tight">
                AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¬ã‚·ãƒ”
            </h1>
            <div class="text-right">
                <p id="user-id-display" class="text-xs text-gray-500 mb-1">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: åŒ¿å</p>
                <button onclick="openNewRecipeModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                    + æ–°ã—ã„ãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
       <!-- â–¼â–¼ åºƒå‘Šï¼šPC / SP å‡ºã—åˆ†ã‘ â–¼â–¼ -->

<!-- PCç”¨åºƒå‘Šï¼ˆ728Ã—90ï¼‰ -->
<div class="ad-desktop">
  <a href="https://px.a8.net/svt/ejp?a8mat=45K4X6+4HXXBM+50+7S05SX" rel="noopener noreferrer nofollow"target="_blank">
    <img border="0" width="728" height="90" alt="" src="https://www24.a8.net/svt/bgt?aid=251202282272&wid=001&eno=01&mid=s00000000018047030000&mc=1">
  </a>
  <img border="0" width="1" height="1" src="https://www16.a8.net/0.gif?a8mat=45K4X6+4HXXBM+50+7S05SX" alt="">
</div>

<!-- ã‚¹ãƒãƒ›ç”¨åºƒå‘Šï¼ˆ300Ã—250ï¼‰ -->
<div class="ad-mobile">
  <a href="https://px.a8.net/svt/ejp?a8mat=45K4X6+4HXXBM+50+7S2AYP" rel="nofollow noopener noreferrer"
     target="_blank">
    <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=251202282272&wid=001&eno=01&mid=s00000000018047040000&mc=1">
  </a>
  <img border="0" width="1" height="1" src="https://www13.a8.net/0.gif?a8mat=45K4X6+4HXXBM+50+7S2AYP" alt="">
</div>

<!-- â–²â–² åºƒå‘Šï¼šPC / SP å‡ºã—åˆ†ã‘ â–²â–² -->

        <h2 class="text-3xl font-bold text-gray-800 mb-6">èª°ã§ã‚‚ä½¿ãˆã‚‹AIãƒ¬ã‚·ãƒ”é›†</h2>
        
        <!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å†é…ç½® -->
        <div class="mb-8 flex justify-end">
            <label for="category-filter" class="text-gray-700 font-medium mr-3 self-center text-sm sm:text-base">ã‚¸ãƒ£ãƒ³ãƒ«ã§çµã‚Šè¾¼ã‚€:</label>
            <select id="category-filter" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 w-full md:w-64">
                <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
                <option value="æ–‡ç« ç”Ÿæˆ">æ–‡ç« ç”Ÿæˆ</option>
                <option value="ç”»åƒç”Ÿæˆ">ç”»åƒç”Ÿæˆ</option>
                <option value="è‡ªå‹•åŒ–">è‡ªå‹•åŒ–</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
        </div>
<!-- â–¼ ãƒ¬ã‚·ãƒ”ä¸€è¦§ãƒªãƒ³ã‚¯ï¼ˆ0000001ã€œ0000014ï¼‰ â–¼ -->
<div class="space-y-2 mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-2">ğŸ“˜ ãƒ¬ã‚·ãƒ”ä¸€è¦§ï¼ˆ0000001ã€œ0000014ï¼‰</h3>

    <ul class="list-disc list-inside text-blue-600">
        <li><a class="underline" href="/recipe-ai/recipes/0000001.html">0000001ï¼šãƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000002.html">0000002ï¼šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000003.html">0000003ï¼šæ–‡ç« æ ¡æ­£ãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000004.html">0000004ï¼šã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒç”»åƒç”Ÿæˆ</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000005.html">0000005ï¼šæ§‹æˆä½œã‚Šãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000006.html">0000006ï¼šSEOè¨˜äº‹ç”Ÿæˆãƒ†ãƒ³ãƒ—ãƒ¬</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000007.html">0000007ï¼šLPæ–‡ç« ç”Ÿæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000008.html">0000008ï¼šåºƒå‘ŠãƒãƒŠãƒ¼ç”Ÿæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000009.html">0000009ï¼šSNSã‚¢ã‚¤ã‚³ãƒ³ç”Ÿæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000010.html">0000010ï¼šã‚ªãƒ³ãƒ©ã‚¤ãƒ³èƒŒæ™¯ãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000011.html">0000011ï¼šãƒ¡ãƒ¼ãƒ«è‡ªå‹•åŒ–ãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000012.html">0000012ï¼šè³‡æ–™ä½œæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000013.html">0000013ï¼šã‚²ãƒ¼ãƒ ç”Ÿæˆãƒ¬ã‚·ãƒ”</a></li>
        <li><a class="underline" href="/recipe-ai/recipes/0000014.html">0000014ï¼šç´¹ä»‹å‹•ç”»ãƒ¬ã‚·ãƒ”</a></li>
    </ul>
</div>
<!-- â–² ãƒ¬ã‚·ãƒ”ä¸€è¦§ãƒªãƒ³ã‚¯ â–² -->
        <div id="loading-indicator" class="text-gray-500 text-center py-8">
            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
        </div>

        <!-- ãƒ¬ã‚·ãƒ”ãƒªã‚¹ãƒˆï¼ˆJavaScriptã§ã‚¸ãƒ£ãƒ³ãƒ«ã”ã¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§è¡¨ç¤º/éè¡¨ç¤ºãŒåˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ï¼‰ -->
        <div id="recipe-list" class="space-y-12">
            <!-- ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ -->
        </div>
    </main>

    <!-- ãƒ¬ã‚·ãƒ”è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="recipe-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-40">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-2xl rounded-xl bg-white pb-20">
            <div class="flex justify-between items-start border-b pb-4 mb-4">
                <div>
                    <span id="modal-category" class="inline-block bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-3 py-1 rounded-full">ã‚¸ãƒ£ãƒ³ãƒ«</span>
                    <h3 id="modal-title" class="text-3xl font-extrabold text-gray-900 mt-2">ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«</h3>
                </div>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">
                    &times;
                </button>
            </div>

            <div class="custom-scrollbar max-h-[75vh] pr-4 overflow-y-auto">
                
                <!-- ç›®çš„ -->
                <section class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">â‘¡ ç›®çš„ï¼ˆã“ã®ãƒ¬ã‚·ãƒ”ã§è§£æ±ºã™ã‚‹èª²é¡Œï¼‰</h4>
                    <p id="modal-purpose" class="text-gray-800"></p>
                </section>

                <!-- é£Ÿæ -->
                <section class="mb-6 p-4 border-l-4 border-blue-500 bg-blue-50 rounded-lg">
                    <h4 class="text-lg font-semibold text-blue-700 mb-3">â‘¢ é£Ÿæï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹æˆè¦ç´ ï¼‰</h4>
                    <div id="modal-ingredients" class="flex flex-wrap gap-2">
                        <!-- é£Ÿæã‚¿ã‚°ãŒã“ã“ã«å…¥ã‚Šã¾ã™ -->
                    </div>
                </section>

                <!-- ãƒ¬ã‚·ãƒ”ï¼ˆæŒ‡ç¤ºæ–‡ç« ï¼‰ -->
                <section class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">â‘£ ãƒ¬ã‚·ãƒ”ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ï¼‰</h4>
                    <pre id="modal-prompt-body" class="whitespace-pre-wrap p-4 bg-gray-900 text-gray-50 rounded-lg text-sm custom-scrollbar max-h-60 overflow-y-auto"></pre>
                    <p class="text-sm text-gray-500 mt-2">â€» <span class="highlight-variable" title="èª¿æ•´å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿">ãƒã‚¤ãƒ©ã‚¤ãƒˆéƒ¨åˆ†</span>ã¯ã€ã‚ãªãŸã®æƒ…å ±ã«åˆã‚ã›ã¦èª¿æ•´ã™ã‚‹å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚</p>
                </section>

                <!-- AIã‚­ãƒƒãƒãƒ³ï¼ˆè©¦ä½œã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ -->
                <section id="try-recipe-section" class="mb-8 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-100 rounded-xl shadow-sm hidden">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-2">âœ¨</span>
                        <h4 class="text-xl font-bold text-indigo-900">AIã‚­ãƒƒãƒãƒ³ï¼šã“ã®ãƒ¬ã‚·ãƒ”ã‚’ä»Šã™ãè©¦ä½œ</h4>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">ä»¥ä¸‹ã®ææ–™ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€GeminiãŒãƒ¬ã‚·ãƒ”é€šã‚Šã«èª¿ç†ï¼ˆç”Ÿæˆï¼‰ã—ã¾ã™ã€‚</p>
                    
                    <!-- å‹•çš„å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div id="try-recipe-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <!-- ã“ã“ã«JSã§å…¥åŠ›æ¬„ãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </div>

                    <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ -->
                    <button id="run-gemini-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md flex justify-center items-center">
                        <span id="run-btn-loader" class="ai-loading mr-2 hidden"></span>
                        <span id="run-btn-text">Geminiã§å®Ÿè¡Œã™ã‚‹</span>
                    </button>

                    <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <div id="try-recipe-result" class="mt-6 hidden">
                        <h5 class="font-bold text-gray-700 mb-2">ç”Ÿæˆçµæœ:</h5>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-inner">
                            <pre id="try-recipe-output" class="whitespace-pre-wrap text-gray-800 text-sm font-mono"></pre>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- èª¿ç†å™¨å…· -->
                    <section class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">â‘¤ èª¿ç†å™¨å…·ï¼ˆä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«ï¼‰</h4>
                        <p id="modal-ai-model" class="text-gray-800 p-3 bg-white border rounded-lg"></p>
                    </section>

                    <!-- ä½¿ã„æ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚³ãƒ„ï¼‰ -->
                    <section class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">â‘¥ ä½¿ã„æ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚³ãƒ„ï¼‰</h4>
                        <pre id="modal-tips" class="text-gray-800 p-3 bg-green-50 rounded-lg text-sm whitespace-pre-wrap"></pre>
                    </section>
                </div>

                <!-- æˆæœç‰©ï¼ˆç”Ÿæˆä¾‹ï¼‰ -->
                <section class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">â‘¦ æˆæœç‰©ï¼ˆç”Ÿæˆç‰©ã®ä¾‹ï¼‰</h4>
                    <pre id="modal-example-output" class="text-gray-800 p-4 bg-yellow-50 rounded-lg text-sm whitespace-pre-wrap custom-scrollbar max-h-60 overflow-y-auto"></pre>
                </section>

                <!-- æ³¨æ„ç‚¹ï¼ˆå¤±æ•—ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼‰ -->
                <section class="mb-6">
                    <h4 class="text-lg font-semibold text-red-700 mb-2">â‘§ æ³¨æ„ç‚¹ï¼ˆå¤±æ•—ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼‰</h4>
                    <pre id="modal-fail-points" class="text-red-700 p-3 bg-red-100 rounded-lg text-sm whitespace-pre-wrap"></pre>
                </section>

                <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                <div class="flex justify-end pt-4 border-t">
                    <button id="delete-recipe-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md hidden">
                        ã“ã®ãƒ¬ã‚·ãƒ”ã‚’å‰Šé™¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°è¦ãƒ¬ã‚·ãƒ”æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="new-recipe-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-2xl rounded-xl bg-white">
            <div class="flex justify-between items-start border-b pb-4 mb-4">
                <h3 class="text-2xl font-bold text-gray-900">æ–°ã—ã„AIãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">
                    &times;
                </button>
            </div>
            
            <form id="new-recipe-form" class="custom-scrollbar max-h-[80vh] pr-4 overflow-y-auto space-y-4">
                <!-- â‘  ã‚¿ã‚¤ãƒˆãƒ« -->
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">â‘  ã‚¿ã‚¤ãƒˆãƒ« (15ã€œ30æ–‡å­—ç¨‹åº¦) <span class="text-red-500">*</span></label>
                    <input type="text" id="title" name="title" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>

                <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700">ã‚¸ãƒ£ãƒ³ãƒ« <span class="text-red-500">*</span></label>
                    <select id="category" name="category" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                        <option value="æ–‡ç« ç”Ÿæˆ">æ–‡ç« ç”Ÿæˆ</option>
                        <option value="ç”»åƒç”Ÿæˆ">ç”»åƒç”Ÿæˆ</option>
                        <option value="è‡ªå‹•åŒ–">è‡ªå‹•åŒ–</option>
                        <option value="ãã®ä»–">ãã®ä»–ï¼ˆã‚²ãƒ¼ãƒ ãƒ»çµµæœ¬ãƒ»å‹•ç”»ãªã©ï¼‰</option>
                    </select>
                </div>
                
                <!-- â‘¡ ç›®çš„ -->
                <div>
                    <label for="purpose" class="block text-sm font-medium text-gray-700">â‘¡ ç›®çš„ï¼ˆã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè§£æ±ºã™ã‚‹èª²é¡Œï¼‰ <span class="text-red-500">*</span></label>
                    <input type="text" id="purpose" name="purpose" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>

                <!-- â‘¢ é£Ÿæ -->
                <div>
                    <label for="ingredients" class="block text-sm font-medium text-gray-700">â‘¢ é£Ÿæï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹æˆè¦ç´ ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ï¼‰ <span class="text-red-500">*</span></label>
                    <input type="text" id="ingredients" name="ingredients" required placeholder="ä¾‹: èª­è€…, ç›®çš„, ãƒˆãƒ¼ãƒ³, å¿…è¦ãªæƒ…å ±, ç¦æ­¢äº‹é …" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>

                <!-- â‘£ ãƒ¬ã‚·ãƒ”ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ï¼‰ -->
                <div>
                    <label for="prompt" class="block text-sm font-medium text-gray-700">â‘£ ãƒ¬ã‚·ãƒ”ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ï¼‰ <span class="text-red-500">*</span></label>
                    <textarea id="prompt" name="prompt" rows="8" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 font-mono text-sm" placeholder="ä¾‹: ã‚ãªãŸã¯ã€å½¹å‰²ã€‘ã§ã™ã€‚ä»¥ä¸‹ã®æ¡ä»¶ã«åŸºã¥ã..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">â€» ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ›¸ãæ›ãˆã‚‹ã¹ãå¯å¤‰éƒ¨åˆ†ã¯ `{ }` ã§å›²ã‚“ã§ãã ã•ã„ã€‚ä¾‹: `{ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŸ‹ã‚ã‚‹æƒ…å ±}`</p>
                </div>

                <!-- â‘¤ èª¿ç†å™¨å…· -->
                <div>
                    <label for="ai_model" class="block text-sm font-medium text-gray-700">â‘¤ èª¿ç†å™¨å…·ï¼ˆä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«ï¼‰ <span class="text-red-500">*</span></label>
                    <input type="text" id="ai_model" name="ai_model" required placeholder="ä¾‹: Gemini 1.5 Proï¼ˆè«–ç†æ€§ãŒé«˜ã„ï¼‰, Midjourney V6ï¼ˆé«˜ç”»è³ªï¼‰" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>

                <!-- â‘¥ ä½¿ã„æ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚³ãƒ„ï¼‰ -->
                <div>
                    <label for="tips" class="block text-sm font-medium text-gray-700">â‘¥ ä½¿ã„æ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚³ãƒ„ï¼‰</label>
                    <textarea id="tips" name="tips" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                </div>

                <!-- â‘¦ æˆæœç‰©ï¼ˆç”Ÿæˆç‰©ã®ä¾‹ï¼‰ -->
                <div>
                    <label for="example_output" class="block text-sm font-medium text-gray-700">â‘¦ æˆæœç‰©ï¼ˆç”Ÿæˆç‰©ã®ä¾‹ï¼‰ <span class="text-red-500">*</span></label>
                    <textarea id="example_output" name="example_output" rows="6" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                </div>

                <!-- â‘§ æ³¨æ„ç‚¹ -->
                <div>
                    <label for="fail_points" class="block text-sm font-medium text-gray-700">â‘§ æ³¨æ„ç‚¹ï¼ˆå¤±æ•—ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼‰</label>
                    <textarea id="fail_points" name="fail_points" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                </div>

                <div class="pt-4 border-t">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md w-full">
                        ãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿ã™ã‚‹
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- â˜…è¿½åŠ : ã‚«ã‚¹ã‚¿ãƒ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-40 mx-auto p-8 border w-96 shadow-2xl rounded-xl bg-white text-center">
            <h3 class="text-xl font-bold text-gray-900 mb-4">å‰Šé™¤ã®ç¢ºèª</h3>
            <p id="confirm-message" class="text-gray-700 mb-6">ãƒ¬ã‚·ãƒ”ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
            <div class="flex justify-center space-x-4">
                <button onclick="closeModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-150">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button id="confirm-delete-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                    å‰Šé™¤ã™ã‚‹
                </button>
            </div>
        </div>
    </div>

</body>

</html>









